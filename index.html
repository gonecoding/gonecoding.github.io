<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fullscreen Color Swiper</title>
    <!-- PWA Meta Tags for iOS Fullscreen/Standalone Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SpookyColor">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Load Tailwind CSS for simple styling and responsiveness --><script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* Ensure the body and html take up the full viewport, essential for mobile/tablet */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* Hide scrollbars */
        }
        /* Style the main container to fill the screen */
        #color-container {
            width: 100vw;
            height: 100vh;
            transition: background-color 0.4s ease-in-out; /* Smooth color transitions */
            touch-action: none; /* Prevents default browser scroll/zoom on touch */
            /* Ensure the cursor indicates it's interactive (optional, but helpful for mouse users) */
            cursor: grab;
            position: relative; /* Needed for absolute positioning of Halloween elements */
            z-index: 1; /* Ensure color is behind Halloween elements */
        }
        #color-container:active {
            cursor: grabbing;
        }

        /* Halloween Elements Container - Initially hidden */
        #halloween-elements {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks to pass through to the color container */
            z-index: 2; /* On top of the color */
            overflow: hidden; /* Important to keep elements within bounds while animating */
            opacity: 0; /* Hidden by default */
            transition: opacity 0.5s ease-in-out;
        }

        #halloween-elements.active {
            opacity: 1; /* Visible when active */
        }

        /* Individual Halloween elements styling */
        .halloween-item {
            position: absolute;
            opacity: 0.7; /* Semi-transparent */
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); /* Subtle shadow */
        }

        /* Keyframes for floating animation (right to left) */
        @keyframes floatRightToLeft {
            0% {
                transform: translateX(100vw);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        /* Keyframes for floating animation (left to right) */
        @keyframes floatLeftToRight {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100vw);
            }
        }

        /* BOO! Overlay styles */
        #boo-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 30vw; /* Huge font size relative to viewport width */
            font-weight: bold;
            opacity: 0; /* Hidden by default */
            pointer-events: none; /* Allows interaction underneath when hidden */
            transition: opacity 0.05s ease-out; /* Quick fade in/out for BOO! text */
            z-index: 100; /* On top of everything */
            text-shadow: 0 0 30px white, 0 0 60px white; /* Glowing effect */
            font-family: 'Creepster', cursive; /* A spooky font, will use a fallback */
            text-transform: uppercase;
        }

        #boo-overlay.active {
            opacity: 1;
        }
        
        /* Flickering effect for the background */
        @keyframes flickering {
            0%, 100% { filter: brightness(1); } /* Normal brightness */
            20%, 80% { filter: brightness(0.8); } /* Slightly dim */
            40%, 60% { filter: brightness(0.6); } /* Dimmer */
            50% { filter: brightness(0.4); } /* Darkest moment */
        }

        #color-container.flicker-active {
            animation: flickering 0.1s infinite alternate; /* Rapid, alternating flicker */
            transition: none; /* Disable smooth background transition during flicker */
        }

        /* Fallback font for Creepster if not available (requires Google Fonts import) */
        @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');
    </style>
</head>
<body class="font-sans">

    <!-- The container that holds the background color and serves as click target --><div id="color-container">
        <!-- Message Box (Hidden by default, used instead of alert()) --><div id="message-box" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 
                                    bg-black bg-opacity-70 text-white px-6 py-3 rounded-xl 
                                    shadow-2xl text-xl opacity-0 transition-opacity duration-300 pointer-events-none z-50">
            Color Changed
        </div>

        <!-- Halloween Elements Container --><div id="halloween-elements">
            <!-- Elements will be dynamically added here by JavaScript --></div>

        <!-- BOO! Overlay (initially hidden) --><div id="boo-overlay">
            BOO!
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('color-container');
            const messageBox = document.getElementById('message-box');
            const halloweenElementsContainer = document.getElementById('halloween-elements');
            const booOverlay = document.getElementById('boo-overlay');
            
            // --- Audio Setup ---
            let noiseSynth = null;
            let audioContextStarted = false;

            // Creates a sharp, unsettling noise burst for the jump scare
            function setupSound() {
                // Set up a NoiseSynth with a fast attack and decay
                noiseSynth = new Tone.NoiseSynth({
                    noise: { type: 'white' }, // White noise is harsh
                    envelope: {
                        attack: 0.01, 
                        decay: 1.0,   
                        sustain: 0,   
                        release: 0.1 
                    },
                    filterEnvelope: {
                        attack: 0.005,
                        decay: 0.2,
                        sustain: 0,
                        release: 0.1,
                        baseFrequency: 500, // Low-frequency start
                        octaves: 3,         // Sweep up a few octaves for a shriek
                        exponent: 2
                    }
                }).toDestination();
            }
            
            // NEW: Function to handle fullscreen request
            function goFullscreen() {
                // Check if already in fullscreen to avoid errors
                if (!document.fullscreenElement && document.documentElement.requestFullscreen) {
                    // NOTE: This standard API call often fails on Mobile Safari/iOS devices
                    // but is kept for compatibility with other touch-enabled browsers.
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log("Fullscreen request denied or failed:", err);
                    });
                }
            }

            // Start the audio context on the first user interaction
            function startAudioContext() {
                if (!audioContextStarted) {
                    Tone.start().then(() => {
                        console.log("Audio Context Started");
                        audioContextStarted = true;
                        setupSound(); 
                    }).catch(err => {
                        console.error("Failed to start Audio Context:", err);
                    });
                }
            }

            // --- State and Config ---
            // UPDATED: Reordered hues to follow the spectrum (ROYGCBPM is roughly 0, 30, 60, 120, 180, 240, 270, 300)
            const baseHues = [
                0,   // Red
                30,  // Orange
                60,  // Yellow
                120, // Green
                180, // Cyan
                240, // Blue
                270, // Purple
                300, // Magenta
            ];
            const hueNames = [
                'Red', 'Orange', 'Yellow', 'Green', 'Cyan', 'Blue', 'Purple', 'Magenta',
            ];
            const lightnessSteps = [0, 20, 40, 50, 60, 80, 100]; 
            let currentLightnessIndex = lightnessSteps.indexOf(50); 
            let currentColorHueIndex = 0; 
            
            const saturation = 100;

            let startX = 0;
            let startY = 0;
            const swipeThreshold = 50; 
            const doubleTapThreshold = 300; // 300ms window for double tap

            let halloweenModeActive = false;
            let lastTapTime = 0; // NEW: Variable to track the time of the last tap

            let booTimeout = null;


            // --- UI Update Function ---
            function updateColor() {
                const currentHue = baseHues[currentColorHueIndex];
                const l = lightnessSteps[currentLightnessIndex]; 
                const newColor = `hsl(${currentHue}, ${saturation}%, ${l}%)`;
                container.style.backgroundColor = newColor;
            }

            // --- Message Box Function (instead of alert) ---
            function showMessage(msg) {
                messageBox.textContent = msg;
                messageBox.classList.remove('opacity-0');
                messageBox.classList.add('opacity-100');
                
                setTimeout(() => {
                    messageBox.classList.remove('opacity-100');
                    messageBox.classList.add('opacity-0');
                }, 800);
            }

            // --- Color/Lightness Controls ---
            function goToNextHue() {
                currentColorHueIndex = (currentColorHueIndex + 1) % baseHues.length;
                updateColor();
                showMessage(`Hue: ${hueNames[currentColorHueIndex]}`);
            }

            function goToPreviousHue() {
                currentColorHueIndex = (currentColorHueIndex - 1 + baseHues.length) % baseHues.length;
                updateColor();
                showMessage(`Hue: ${hueNames[currentColorHueIndex]}`);
            }

            function adjustLightness(direction) {
                if (direction === 'UP') {
                    currentLightnessIndex = Math.min(lightnessSteps.length - 1, currentLightnessIndex + 1);
                } else if (direction === 'DOWN') {
                    currentLightnessIndex = Math.max(0, currentLightnessIndex - 1);
                }
                updateColor();
                showMessage(`Lightness: ${lightnessSteps[currentLightnessIndex]}%`);
            }

            function processSwipe(endX, endY) {
                const diffX = endX - startX;
                const diffY = endY - startY;
                const absDiffX = Math.abs(diffX);
                const absDiffY = Math.abs(diffY);

                if (absDiffX >= swipeThreshold || absDiffY >= swipeThreshold) {
                    if (absDiffX > absDiffY) {
                        if (diffX > 0) { goToNextHue(); } else { goToPreviousHue(); }
                    } else {
                        if (diffY > 0) { adjustLightness('DOWN'); } else { adjustLightness('UP'); }
                    }
                }
            }

            // --- Halloween Mode Logic ---
            const halloweenSvgs = {
                ghost: `<svg xmlns="http://www.w3.org/2000/svg" xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/" version="1.1" viewBox="0 0 238.55624 300.51344"><defs><style>.cls-1{fill:#231f20;}.cls-2{fill:#fff;}</style></defs><g><g id="Layer_1"><g><path class="cls-1" d="M238.38105,260.63344c-1.46997-8.27002-11.5-13.48004-15.01001-15.07001-4.97998-3.27002-9.38-7.34003-12.72998-11.75-21.14001-28.46002-20.54999-69.48999-10.59998-97.53003l.12-.39996c1.04999-4.48004,2.19-5.14001,2.19-5.14001.85999-.22998,3.98999,1.77997,5.66998,2.85999,4.16998,2.67999,9.35999,6.01001,15.08002,4.59003,13.08997-2.72003,12.62-23.07001,11.39996-30.23004-1.47998-14.98999-10.78998-28.94995-22.19-33.22998-8.38995-3.14996-17.25-.90997-24.96997,6.31-.08002.06-.15002.10999-.21002.16003-.19-1.09003-.32001-2.40002-.39996-3.13-.08002-.79004-.15002-1.47003-.24005-2.04004-.12994-.72998-.26996-1.83997-.44995-3.23999-1.01001-7.95001-3.11005-24.48999-10.85004-39.78998C165.37104,13.61342,149.94105,2.70344,129.33106.58345h-.01001c-28.19-2.85004-48.75,4.75-61.09998,22.60999-10.23004,14.79999-12.67999,33.08997-14.48004,46.45001-.58997,4.35999-1.28998,9.62-2.12,11.97998-.06995-.06-.14996-.12-.22998-.19l-.28998-.23999c-9.97003-7.23004-17.78003-5.23999-22.58002-2.29999-5.45001,3.33997-10.01001,9.87-12.84003,18.37994-2.45996,7.44-3.33997,15.71002-2.34998,22.16003l.09003.90002c.53998,5.25995,1.42999,14.07996,8.70996,16.67999,6.47003,2.32001,11.03003-2.27002,14.35999-5.62,3.58002-3.60004,4.67004-4.21002,6.08002-3.46002.73999.52997,1.46002,2.94,2.12,7.17999.07001.45001.14001.88.21002,1.25,8.39001,48.56-18.66998,85.57001-33.21002,105.45001-3.95996,5.39996-6.81,9.31-8.13,12.28998-4.25,9.54999-4.71997,20.09003-1.27997,28.20001,2.77997,6.53003,7.94,11.32001,15.02002,13.89001,20.66998,6.92999,36.77997-4.88,52.34998-16.29004,10.39001-7.62,20.21002-14.81,31.12-16.63,4.53998-.39996,7.46997,4.35004,9.12,8.43005.39001.94995.77002,1.91998,1.15002,2.90997,3.69995,9.39001,7.88,20.03998,19.07001,24.12,3.38995,1.23999,6.59998,1.78003,9.63995,1.78003,11.44,0,20.62-7.63,28.92004-14.53003,7.50995-6.25,14.60999-12.15997,22.84998-12.95001l.21002-.02997c4.75-.73004,9.91998.28998,15.38995,1.35999,8.72003,1.72003,17.73004,3.48999,26.18005-1.64001l.34998-.21997.29999-.29004c4.58002-4.40997,4.94-8.72998,4.42999-11.57996Z"/><path class="cls-2" d="M231.02107,261.93342c-.54999-3.08002-5.06-7.06-10.96002-9.66003l-.52997-.27997c-5.78003-3.77002-10.92999-8.5-14.87-13.69-22.76001-30.64001-22.29004-74.41998-11.73004-104.33002.87006-3.62,2.5-8.48999,6.62006-10.15997,4.33997-1.76001,8.5.90997,12.50995,3.5,3.28003,2.09998,6.67999,4.27997,9.28003,3.60999l.20001-.03998c6.06-1.22003,6.83997-14.61005,5.57001-21.77002l-.04004-.28998c-1.15997-12.16003-8.63-23.80005-17.38-27.09003-5.78998-2.17999-11.63-.52997-17.35999,4.88l-.27002.22998c-3.60999,2.81-6.69995,3.39001-9.16998,1.72003-3.21429-2.17316-3.30945-7.34369-4.26001-14.82001-1.92999-15.17999-7.82001-61.37-50.06-65.72003-58.20001-5.88995-63.97998,36.99005-67.41998,62.61005-1.41998,10.59998-2.28003,17-6.91998,18.71997-2.38.88-4.96002.14001-7.66003-2.20996-5.33997-3.82001-9.96997-4.43005-14.14001-1.87006-8.53998,5.23004-13.37994,22.38-11.69995,33.10004l.01996.17999.11005,1.02002c.37994,3.73999.94995,9.38995,3.78998,10.39996,1.70001.61005,3.19-.47998,6.53998-3.84998,3.29004-3.31,8.27002-8.32001,14.92004-4.77002,4.34998,2.32001,5.31995,8.5,5.96997,12.60004.06.40997.12.78998.17999,1.13995,8.94,51.67999-19.33997,90.36005-34.53998,111.13-3.40002,4.65002-6.33002,8.67004-7.33002,10.91003-3.41998,7.70001-3.88,16.01001-1.22998,22.23999,1.96997,4.64001,5.53998,7.91998,10.60999,9.76001,16.90997,5.66998,30.78003-4.5,45.46002-15.26001,10.67999-7.83002,21.72998-15.91998,34.44995-18l.21002-.03003c.51001-.04999,1.02002-.07996,1.52002-.07996,6.51996,0,11.95001,4.60999,15.40997,13.13.40002.97998.79004,1.97998,1.17999,2.97998,3.27002,8.32001,6.65002,16.90997,14.67004,19.83997,12.10999,4.41003,20.95996-2.94995,31.21997-11.47998,8.02002-6.67999,16.33002-13.58002,26.81-14.63,6-.89996,12.03003.28003,17.85999,1.42999,7.5,1.47003,14.60004,2.86005,20.5-.48999,2.35004-2.40997,2.06-4.04999,1.96002-4.60999ZM101.40443,65.88167c-5.61743-.33887-9.74115-7.74371-9.21051-16.53906.53058-8.79541,5.51453-15.65082,11.1319-15.31195,5.61743.33887,9.74115,7.74365,9.21057,16.53906s-5.51453,15.65082-11.13196,15.31195ZM128.9192,92.64223c-.55762,9.24329-6.47632,16.40662-13.21985,15.99982s-11.75818-8.22974-11.20056-17.47296c.55756-9.24329,6.47632-16.40662,13.21979-15.99982,6.74353.4068,11.75818,8.22974,11.20062,17.47296ZM148.19593,52.7209c-.53058,8.79541-5.51453,15.65076-11.13196,15.31189s-9.74109-7.74365-9.21051-16.53906,5.51453-15.65076,11.13196-15.31189c5.61737.33887,9.74115,7.74365,9.21051,16.53906Z"/></g></g></g>`,
                pumpkin: `<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><g><g><path fill="#8BC53F" d="M54.3,31.6c0,0,3.6-6.4-2.1-10.7c-0.3-0.2-0.6-0.3-0.9-0.3h-0.1c-1.1,0-1.8,1.2-1.4,2.2c0.9,2,1.2,4.9-2.8,7.3L54.3,31.6z"/></g><path fill="#231F20" d="M49.3,20.6c0.3,0,0.6,0.1,0.9,0.3c5.7,4.3,2.1,10.7,2.1,10.7l-7.3-1.5c4-2.4,3.7-5.3,2.8-7.3c-0.5-1,0.2-2.2,1.4-2.2H49.3M49.3,17.6h-0.1c-1.5,0-3,0.8-3.8,2.1c-0.8,1.3-1,2.9-0.3,4.4c0.5,1,0.7,2.1-1.6,3.5c-1.1,0.6-1.6,1.9-1.4,3.1c0.2,1.2,1.1,2.2,2.3,2.4l7.3,1.5c0.2,0,0.4,0.1,0.6,0.1c1.1,0,2.1-0.6,2.6-1.5c1.7-3,3.2-10-2.9-14.6C51.2,17.9,50.3,17.6,49.3,17.6L49.3,17.6z"/><g><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="52.3752" y1="84.3013" x2="52.3752" y2="25.1558"><stop offset="0" style="stop-color:#F6921E"/><stop offset="0.3442" style="stop-color:#F7951D"/><stop offset="0.5983" style="stop-color:#F89E1A"/><stop offset="0.8228" style="stop-color:#FBAE14"/><stop offset="1" style="stop-color:#FFC10E"/></linearGradient><path fill="url(#SVGID_1_)" d="M83.5,50.4c0-11.1-10.1-21.3-21.7-21.3c-3.7,0-9.5,0.9-12.5,2.5c-3-1.6-5.4-1.3-9-1.3c-11.6,0-19.1,9-19.1,20.1c0,5.5,2.3,10.4,6,14.1c-0.1,0.7-0.2,1.3-0.2,2c0,7.2,6.2,13.1,13.8,13.1c1.9,0,4.8,1.7,6.5,1.1c2.1,0.7,2.4,0,4.8,0c2.2,0,5.5,0.8,7.5,0.3c1.6,0.6,3-1.3,4.7-1.3c7.6,0,13.8-5.9,13.8-13.1c0-0.8-0.1-1.6-0.2-2.3C81.4,60.5,83.5,55.7,83.5,50.4z"/></g><path fill="#231F20" d="M59.2,76.1c-0.3,0-0.6-0.1-0.8-0.4c-0.3-0.4-0.2-1.1,0.2-1.4c1.3-1,2.3-2.3,3-3.8c0.2-0.5,0.8-0.7,1.3-0.5c0.5,0.2,0.7,0.8,0.5,1.3c-0.8,1.9-2.1,3.4-3.6,4.6C59.6,76,59.4,76.1,59.2,76.1zM63.7,67.1C63.7,67.1,63.6,67.1,63.7,67.1c-0.6,0-1-0.5-1-1.1c0-0.4,0-0.9,0-1.3c0-2.5-0.5-4.3-0.5-4.4c-0.1-0.5,0.2-1.1,0.7-1.2s1.1,0.2,1.2,0.7c0,0.1,0.6,2.1,0.6,4.9c0,0.5,0,0.9-0.1,1.4C64.6,66.7,64.2,67.1,63.7,67.1z"/><path fill="#231F20" d="M38.7,76.1c-0.2,0-0.4-0.1-0.6-0.2c-1.6-1.2-2.8-2.7-3.6-4.6c-0.2-0.5,0-1.1,0.5-1.3c0.5-0.2,1.1,0,1.3,0.5c0.7,1.5,1.7,2.8,3,3.8c0.4,0.3,0.5,1,0.2,1.4C39.3,76,39,76.1,38.7,76.1zM34.2,67.1c-0.5,0-1-0.4-1-0.9c0-0.5-0.1-1-0.1-1.4c0-2.7,0.5-4.8,0.6-4.9c0.1-0.5,0.7-0.9,1.2-0.7c0.5,0.1,0.9,0.7,0.7,1.2c0,0-0.5,1.9-0.5,4.4c0,0.4,0,0.8,0,1.3C35.3,66.5,34.9,67,34.2,67.1C34.3,67.1,34.3,67.1,34.2,67.1z"/><path fill="#231F20" d="M58.5,30.3c11.1,0,20.1,9,20.1,20.1c0,5.3-2.1,10.1-5.5,13.7c0.1,0.8,0.2,1.5,0.2,2.3c0,7.2-5.9,13.1-13.1,13.1c-1.7,0-3.3-0.3-4.8-0.9c-1.9,0.6-3.9,0.9-6,0.9c-2.2,0-4.4-0.4-6.4-1.1c-1.6,0.7-3.3,1.1-5.1,1.1c-7.2,0-13.1-5.9-13.1-13.1c0-0.7,0.1-1.3,0.2-2c-3.6-3.6-5.8-8.6-5.8-14.1c0-11.1,9-20.1,20.1-20.1c3.5,0,6.7,0.9,9.6,2.4C51.7,31.2,55,30.3,58.5,30.3M58.5,27.3c-3.3,0-6.6,0.7-9.6,2.1c-3-1.4-6.3-2.1-9.6-2.1c-12.7,0-23.1,10.3-23.1,23.1c0,5.6,2,10.9,5.6,15.1c0,0.3,0,0.7,0,1c0,8.9,7.2,16.1,16.1,16.1c1.8,0,3.6-0.3,5.2-0.9c2.1,0.6,4.2,0.9,6.3,0.9c2,0,4-0.3,5.9-0.8c1.6,0.5,3.2,0.8,4.9,0.8c8.9,0,16.1-7.2,16.1-16.1c0-0.5,0-0.9-0.1-1.4c3.4-4.1,5.3-9.3,5.3-14.7C81.5,37.7,71.2,27.3,58.5,27.3L58.5,27.3z"/><g><path fill="#FFF100" d="M63.6,43.2c0,6.9-4.9,12.7-11.4,14.1c0.1,1.3,0.4,2.6,0.9,3.8c1.7,0.7,3.5,1.1,5.4,1.1c7.9,0,14.4-6.4,14.4-14.4c0-1.8-0.3-3.5-0.9-5.1c-1.7-0.7-3.5-1.1-5.4-1.1c-1,0-2,0.1-3,0.3C63.5,42.3,63.6,42.8,63.6,43.2z"/><path fill="#FFF100" d="M34.2,43.2c0,6.9,4.9,12.7,11.4,14.1c-0.1,1.3-0.4,2.6-0.9,3.8c-1.7,0.7-3.5,1.1-5.4,1.1c-7.9,0-14.4-6.4-14.4-14.4c0-1.8,0.3-3.5,0.9-5.1c1.7-0.7,3.5-1.1,5.4-1.1c1,0,2,0.1,3,0.3C34.2,42.3,34.2,42.8,34.2,43.2z"/></g><circle fill="#FFF100" cx="49.1" cy="70.9" r="4.4"/><g><path fill="#231F20" d="M58.5,63.6c-2.1,0-4.1-0.4-6-1.2c-0.4-0.2-0.7-0.5-0.8-0.9c-0.5-1.4-0.8-2.8-1-4.2c-0.1-0.8,0.4-1.5,1.2-1.6c5.9-1.2,10.2-6.5,10.2-12.6c0-0.4,0-0.8-0.1-1.2c-0.1-0.8,0.4-1.4,1.2-1.6c3.1-0.7,6.4-0.4,9.3,0.8c0.4,0.2,0.7,0.5,0.8,0.9c0.7,1.8,1,3.7,1,5.6C74.4,56.5,67.2,63.6,58.5,63.6zM54.2,59.9c1.4,0.5,2.8,0.7,4.3,0.7c7.1,0,12.9-5.8,12.9-12.9c0-1.3-0.2-2.6-0.6-3.9c-1.8-0.6-3.7-0.9-5.7-0.6c0,0,0,0,0,0c0,7-4.6,13.2-11.2,15.2C53.9,58.9,54.1,59.4,54.2,59.9z"/><path fill="#231F20" d="M39.3,63.6c-8.8,0-15.9-7.1-15.9-15.9c0-1.9,0.4-3.8,1-5.6c0.1-0.4,0.5-0.7,0.8-0.9c2.9-1.2,6.2-1.5,9.3-0.8c0.7,0.2,1.3,0.8,1.2,1.6c0,0.4-0.1,0.8-0.1,1.2c0,6.1,4.3,11.4,10.2,12.6c0.7,0.2,1.3,0.8,1.2,1.6c-0.1,1.4-0.5,2.8-1,4.2c-0.1,0.4-0.4,0.7-0.8,0.9C43.4,63.2,41.3,63.6,39.3,63.6zM27,43.8c-0.4,1.3-0.6,2.6-0.6,3.9c0,7.1,5.8,12.9,12.9,12.9c1.5,0,2.9-0.2,4.3-0.7c0.2-0.5,0.3-1,0.4-1.5c-6.6-2-11.2-8.2-11.2-15.2c0,0,0,0,0,0C30.8,42.9,28.8,43.2,27,43.8z"/></g><path fill="#231F20" d="M49.1,76.9c-3.3,0-5.9-2.7-5.9-5.9s2.7-5.9,5.9-5.9c3.3,0,5.9,2.7,5.9,5.9S52.3,76.9,49.1,76.9zM49.1,68c-1.6,0-2.9,1.3-2.9,2.9s1.3,2.9,2.9,2.9c1.6,0,2.9-1.3,2.9-2.9S50.7,68,49.1,68z"/><path fill="#231F20" d="M30.7,43.1c-0.6,0-1-0.4-1-1c0-1.3,0.2-2.5,0.6-3.6c0.2-0.5,0.8-0.8,1.3-0.6c0.5,0.2,0.8,0.8,0.6,1.3c-0.3,0.9-0.5,1.8-0.5,2.9C31.7,42.7,31.3,43.1,30.7,43.1zM34.2,36c-0.3,0-0.6-0.2-0.8-0.4c-0.3-0.5-0.2-1.1,0.3-1.4c2.8-1.9,6-2,6.2-2.1c0.5,0,1,0.4,1,1c0,0.6-0.4,1-1,1c-0.1,0-2.8,0.1-5.1,1.7C34.6,35.9,34.4,36,34.2,36z"/><path fill="#231F20" d="M67.2,43.1C67.2,43.1,67.2,43.1,67.2,43.1c-0.6,0-1-0.4-1-1c0-1.1-0.2-2.1-0.5-3c-0.2-0.5,0.1-1.1,0.6-1.3c0.5-0.2,1.1,0.1,1.3,0.6c0.4,1.1,0.6,2.3,0.6,3.7C68.2,42.7,67.8,43.1,67.2,43.1zM63.6,36c-0.2,0-0.4-0.1-0.5-0.2c-2.3-1.5-5.1-1.5-5.2-1.5c-0.6,0-1-0.5-1-1c0-0.6,0.4-1,1-1c0.1,0,3.4,0,6.2,1.8c0.5,0.3,0.6,0.9,0.3,1.4C64.2,35.8,63.9,36,63.6,36z"/><path fill="#231F20" d="M48.7,51.1c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C49.7,50.7,49.3,51.1,48.7,51.1zM48.7,44.1c-0.6,0-1-0.4-1-1v-6c0-0.6,0.4-1,1-1s1,0.4,1,1v6C49.7,43.7,49.3,44.1,48.7,44.1z"/></g></svg>`,
                bat: `<svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><style type="text/css">.st0{fill:#000000;}</style><g><path class="st0" d="M372.084,106.642c9.277,64.285-67.483,102.934-76.724,103.858c-15.122,1.498-2.291-20.244,0.566-43.667c2.857-23.414-22.813,21.742-39.922,21.742c-17.108,0-42.778-45.156-39.93-21.742c2.858,23.423,15.688,45.165,0.566,43.667c-9.242-0.923-86.001-39.573-76.724-103.858C79.202,131.363-9.325,265.891,0.797,276.762c10.122,10.889,57.334-15.827,88.527,53.424c28.293-26.785,62.865-20.845,80.104,40.558c56.507-40.035,74.747,16.62,86.576,34.616c11.821-17.996,30.061-74.65,86.568-34.616c17.238-61.402,51.812-67.343,80.112-40.558c31.194-69.251,78.406-42.535,88.519-53.424C521.324,265.891,432.797,131.363,372.084,106.642z"/></g></svg>`,
            };

            function createHalloweenElement(type) {
                const item = document.createElement('div');
                item.classList.add('halloween-item');
                item.innerHTML = halloweenSvgs[type];

                const size = Math.random() * (360 - 180) + 180;
                item.style.width = `${size}px`;
                item.style.height = `${size}px`;
                
                const startY = Math.random() * 100; 
                item.style.top = `${startY}vh`;

                const animationDuration = Math.random() * (30 - 15) + 15;
                const animationDelay = Math.random() * -animationDuration;

                const direction = Math.random() > 0.5 ? 'floatRightToLeft' : 'floatLeftToRight';
                item.style.animation = `${direction} ${animationDuration}s ${animationDelay}s linear infinite`;

                halloweenElementsContainer.appendChild(item);
            }

            function setupHalloweenElements() {
                halloweenElementsContainer.innerHTML = ''; 
                for (let i = 0; i < 3; i++) {
                    createHalloweenElement('ghost');
                    createHalloweenElement('pumpkin');
                    createHalloweenElement('bat');
                }
            }

            function scheduleBooFlash() {
                if (booTimeout) clearTimeout(booTimeout);

                const randomDelay = Math.random() * (15000 - 5000) + 5000;
                booTimeout = setTimeout(performBooFlash, randomDelay);
            }

            function performBooFlash() {
                // 1. Play Sound
                if (noiseSynth) {
                    noiseSynth.triggerAttackRelease(1.0); 
                }

                // 2. Start Visual Flicker
                booOverlay.classList.add('active');
                container.classList.add('flicker-active');

                // 3. Stop Flicker and Reschedule after 1 second
                setTimeout(() => {
                    booOverlay.classList.remove('active');
                    container.classList.remove('flicker-active');
                    if (halloweenModeActive) { 
                        scheduleBooFlash();
                    }
                }, 1000); 
            }


            function toggleHalloweenMode() {
                halloweenModeActive = !halloweenModeActive;
                if (halloweenModeActive) {
                    halloweenElementsContainer.classList.add('active');
                    setupHalloweenElements(); 
                    scheduleBooFlash();
                    showMessage("Halloween Mode ON!");
                } else {
                    halloweenElementsContainer.classList.remove('active');
                    setTimeout(() => { halloweenElementsContainer.innerHTML = ''; }, 500); 
                    if (booTimeout) clearTimeout(booTimeout); 
                    booOverlay.classList.remove('active'); 
                    container.classList.remove('flicker-active'); 
                    showMessage("Halloween Mode OFF!");
                }
            }

            // --- Event Handlers (TOUCH ONLY) ---

            // Initial setup on load
            updateColor();

            // TOUCH EVENTS
            container.addEventListener('touchstart', (e) => {
                startAudioContext(); 
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            }, { passive: true });

            container.addEventListener('touchmove', (e) => {
                // Not strictly needed for logic but kept for complete event structure reference.
            }, { passive: true });

            container.addEventListener('touchend', (e) => {
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const currentTime = Date.now();
                
                const absDiffX = Math.abs(endX - startX);
                const absDiffY = Math.abs(endY - startY);

                if (absDiffX >= swipeThreshold || absDiffY >= swipeThreshold) { 
                    // 1. It was a significant drag, treat as SWIPE
                    processSwipe(endX, endY);
                } else {
                    // 2. It was a small movement/tap
                    if (currentTime - lastTapTime < doubleTapThreshold) {
                        // Double Tap detected -> Go Fullscreen
                        goFullscreen();
                        // Reset lastTapTime to avoid triple tap confusion
                        lastTapTime = 0; 
                        showMessage("Fullscreen Mode");
                    } else {
                        // Single Tap detected -> Toggle Halloween Mode
                        toggleHalloweenMode();
                        // Record time of this single tap
                        lastTapTime = currentTime;
                    }
                }
                
                // Ensure start coordinates are reset for the next touch event regardless of the action taken.
                startX = 0; 
                startY = 0; 
            }, { passive: true });
            
        });
    </script>
</body>
</html>
